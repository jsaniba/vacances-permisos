<!DOCTYPE html>
<html lang="ca">
<head>
  <meta charset="UTF-8">
  <title>Formulari de Petici贸</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      margin: 0;
      padding: 0;
    }
    .container {
      width: 600px;
      max-width: 96%;
      margin: 24px auto;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.12);
      padding: 20px;
    }
    .header {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
    }
    .header img {
      width: 286px;
      height: 124px;
      object-fit: contain;
      margin-right: 20px;
    }
    .header h2 {
      margin: 0;
      color: #333;
      font-size: 24px;
    }
    label {
      display: block;
      margin-top: 10px;
      color: #444;
      font-weight: bold;
    }
    input[type="text"], select, textarea, input[type="date"] {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 6px;
      box-sizing: border-box;
    }
    .checkbox-group {
      margin-top: 8px;
    }
    .row {
      display:flex;
      gap:8px;
      align-items:center;
    }
    button {
      width: 48%;
      padding: 12px;
      margin-top: 20px;
      border: none;
      border-radius: 8px;
      background: #007BFF;
      color: white;
      font-size: 16px;
      cursor: pointer;
    }
    button:hover { background: #0056b3; }
    button.reset {
      background: #6c757d;
      margin-left: 4%;
    }
    button.reset:hover { background: #5a6268; }
    .apple-message {
      text-align: center;
      padding: 16px;
      border-radius: 10px;
      background: #eef6ff;
      margin-bottom: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    }
    .apple-button {
      display: inline-block;
      padding: 12px 18px;
      background: #007BFF;
      color: #fff;
      font-size: 16px;
      border-radius: 8px;
      text-decoration: none;
      margin-top: 10px;
    }
    .apple-button:hover { background: #0056b3; }
    hr.small { border: none; height: 1px; background: #eee; margin: 12px 0; }
    .marca {
      text-align: right;
      font-size: 12px;
      color: maroon;
      font-style: italic;
      margin-top: 16px;
      opacity: 0.9;
    }
  </style>
</head>
<body>
  <div class="container" id="form-container">
    <div class="header">
      <img src="logo.jpg" alt="Logo">
      <h2>FORMULARI DE PETICI</h2>
    </div>

    <div id="apple-banner-placeholder"></div>

    <form id="formulari" autocomplete="off" onsubmit="enviarFormulario(); return false;">
      <label for="nom">NOM </label>
      <input type="text" id="nom" name="nom" autocomplete="off" required>

      <label for="nip">NIP</label>
      <input type="text" id="nip" name="nip" autocomplete="off" required>

      <label for="lloc">LLOC DE TREBALL</label>
      <select id="lloc" name="lloc" required>
        <option value="">-- Selecciona --</option>
        <option>Auxiliar Administratiu/iva</option>
        <option>Bibliotecari/ria</option>
        <option>Cap de Programes d'Atenci贸 Especialitzada</option>
        <option>Cap de Programes d'Educaci贸 Social</option>
        <option>Cap de Serveis</option>
        <option>Cap d'Unitat</option>
        <option>Conductor/a</option>
        <option>Coordinador d'Equips Multidisciplinaris</option>
        <option>CUE</option>
        <option>CUSI</option>
        <option>CUSV</option>
        <option>Director/a</option>
        <option>Educador/a</option>
        <option>CAF</option>
        <option>Encarregat/a d'rea Administrativa</option>
        <option>Enginyer</option>
        <option>GAMP</option>
        <option>GAMV</option>
        <option>Gerent</option>
        <option>GO</option>
        <option>GSI</option>
        <option>Monitor/a formaci贸 ocupacional</option>
        <option>RIET</option>
        <option>Secretari/a T猫cnic Jurdic</option>
        <option>Subdirector/a de Tractament</option>
        <option>Subdirector/a d'Interior</option>
        <option>T猫cnic de Prevenci贸 i Salut Laboral</option>
        <option>Titulat/ada Superior Crimin貌leg</option>
        <option>Titulat/ada Superior Pedagog/a</option>
        <option>Titulat/ada Superior Psic貌leg/a</option>
        <option>TMI</option>
      </select>

      <label for="guardia">GURDIA</label>
      <select id="guardia" name="guardia" required>
        <option value="">-- Selecciona --</option>
        <option>A</option>
        <option>B</option>
        <option>C</option>
        <option>D</option>
        <option>E</option>
        <option>F</option>
        <option>G</option>
        <option>H</option>
        <option>Equip de Tractament</option>
        <option>MAT</option>
        <option>TARDA</option>
        <option>C/S</option>
        <option>Cap Serveis</option>
        <option>Gesti贸 Econ貌mica</option>
        <option>Gesti贸 Penitenciria</option>
        <option>OGI</option>
        <option>Recursos Humans</option>
        <option>SERVEIS EXT. C/S</option>
        <option>SERVEIS EXT. MAT</option>
        <option>SERVEIS EXT. TARDA</option>
        <option>SERVEIS INT. C/S</option>
        <option>SERVEIS INT. MAT</option>
        <option>SERVEIS INT. TARDA</option>
        <option>Suport Administratiu Equips Directius</option>
        <option>TALLERS MAT</option>
        <option>TALLERS TARDA</option>
        <option>USI MAT</option>
        <option>USI TARDA</option>
      </select>

      <hr class="small">

      <label>PLANIFICAT AMB EL QUADRANT DE LA GURDIA</label>
      <div class="checkbox-group">
        <label><input type="radio" name="planificat" value="SI"> SI</label>
        <label style="margin-left:8px;"><input type="radio" name="planificat" value="NO"> NO</label>
      </div>

      <label>TIPUS DE PETICI</label>
      <div class="checkbox-group">
        <label><input type="checkbox" name="tipus" value="VACANCES"> VACANCES</label><br>
        <label><input type="checkbox" name="tipus" value="ASSUMPTES PERSONALS"> ASSUMPTES PERSONALS</label><br>
        <label><input type="checkbox" name="tipus" value="COMPENSACI DE FESTIUS"> COMPENSACI DE FESTIUS</label><br>
        <label><input type="checkbox" name="tipus" value="HORES DE FORMACI"> HORES DE FORMACI</label><br>
        <label><input type="checkbox" name="tipus" value="HORES EXTRAORDINRIES"> HORES EXTRAORDINRIES</label><br>
        <label><input type="checkbox" name="tipus" value="ALTRES"> ALTRES</label>
      </div>

      <label for="especifiqueu">ESPECIFIQUEU</label>
      <input type="text" id="especifiqueu" name="especifiqueu">

      <label for="data_inici">DATA INICI</label>
      <input type="date" id="data_inici" name="data_inici" required>

      <label for="data_fi">DATA FI</label>
      <input type="date" id="data_fi" name="data_fi" required>

      <div class="checkbox-group">
        <label><input type="checkbox" name="tipus" value="TORNS"> TORNS</label><br>
        <label><input type="checkbox" name="tipus" value="HORES"> HORES</label><br>
      </div>

      <label for="total">TOTAL TORNS/HORES</label>
      <input type="text" id="total" name="total">

      <label for="observacions">OBSERVACIONS</label>
      <textarea id="observacions" name="observacions" rows="4"></textarea>

      <div style="display:flex; justify-content: space-between;">
        <button id="submitBtn" type="submit">Crear Correu</button>
        <button type="button" class="reset" onclick="limpiarFormulario()">Netejar Formulari</button>
      </div>

      <div class="marca">created by JSI Workstation</div>
    </form>
  </div>

  <script>
    function enviarFormulario() {
      const dataInici = document.getElementById('data_inici').value;
      const dataFi = document.getElementById('data_fi').value;

      if (!dataInici || !dataFi) {
        alert("锔 Cal introduir totes les dates correctament abans d'enviar.");
        return;
      }

      const inici = new Date(dataInici);
      const fi = new Date(dataFi);

      if (isNaN(inici.getTime()) || isNaN(fi.getTime())) {
        alert("锔 Una de les dates no 茅s vlida.");
        return;
      }

      if (fi < inici) {
        alert("锔 La data final no pot ser anterior a la data inicial.");
        return;
      }

      // Al menos un checkbox TORNS o HORES
      const tornsOhores = Array.from(document.querySelectorAll('input[name="tipus"][value="TORNS"], input[name="tipus"][value="HORES"]'))
        .some(cb => cb.checked);
      if (!tornsOhores) {
        alert("锔 Marca almenys TORNS o HORES.");
        return;
      }

      const nom = document.getElementById('nom').value;
      const nip = document.getElementById('nip').value;
      const lloc = document.getElementById('lloc').value;
      const guardia = document.getElementById('guardia').value;
      const planificat = document.querySelector('input[name="planificat"]:checked')?.value || '';
      const tipus = Array.from(document.querySelectorAll('input[name="tipus"]:checked')).map(cb => cb.value).join(", ");
      const especifiqueu = document.getElementById('especifiqueu').value;
      const total = document.getElementById('total').value;
      const observacions = document.getElementById('observacions').value;

      let body =
        "NOM : " + nom + "\n" +
        "NIP: " + nip + "\n" +
        "LLOC DE TREBALL: " + lloc + "\n" +
        "GURDIA: " + guardia + "\n\n" +
        "----------------------------------------\n\n" +
        "PLANIFICAT AMB EL QUADRANT DE LA GURDIA: " + planificat + "\n" +
        "TIPUS DE PETICI: " + tipus + "\n" +
        "ESPECIFIQUEU: " + especifiqueu + "\n" +
        "DATA INICI: " + dataInici + "\n" +
        "DATA FI: " + dataFi + "\n" +
        "TOTAL TORNS/HORES: " + total + "\n" +
        "OBSERVACIONS: " + observacions;

      let subject = nip + "--" + lloc + "--" + guardia;
      const mesos = ["Gener","Febrer","Mar莽","Abril","Maig","Juny","Juliol","Agost","Setembre","Octubre","Novembre","Desembre"];
      subject += "--" + mesos[inici.getMonth()] + " " + inici.getFullYear();

      const mailtoLink = "mailto:vacances_aps_cppb.justicia@gencat.cat?subject=" + encodeURIComponent(subject) + "&body=" + encodeURIComponent(body);

      const ua = navigator.userAgent || navigator.vendor || window.opera;

      if (/iPhone|iPad/i.test(ua)) {
        const bannerPlaceholder = document.getElementById('apple-banner-placeholder');
        bannerPlaceholder.innerHTML = `
          <div class="apple-message" id="apple-message">
            <strong>Per enviar des del teu iPhone/iPad</strong>
            <p>Prem el bot贸 seg眉ent per obrir la teva aplicaci贸 de correu i enviar el formulari.</p>
            <a class="apple-button" id="apple-mail-link" href="${mailtoLink}"> Obrir correu</a>
            <div style="margin-top:10px;">
              <button type="button" onclick="hideAppleBanner()" style="background:#6c757d;padding:8px 12px;border-radius:6px;border:none;color:#fff;cursor:pointer;">Tancar avis</button>
            </div>
          </div>
        `;
        document.getElementById('submitBtn').disabled = true;
        return;
      }

      if (/Macintosh/i.test(ua)) {
        const bannerPlaceholder = document.getElementById('apple-banner-placeholder');
        bannerPlaceholder.innerHTML = `
          <div class="apple-message" id="apple-message">
            <strong>Obre el teu correu</strong>
            <p>Fes clic al bot贸 seg眉ent per enviar el formulari:</p>
            <a class="apple-button" id="apple-mail-link-mac" href="${mailtoLink}"> Obrir correu</a>
            <div style="margin-top:10px;">
              <button type="button" onclick="hideAppleBanner()" style="background:#6c757d;padding:8px 12px;border-radius:6px;border:none;color:#fff;cursor:pointer;">Tancar avis</button>
            </div>
          </div>
        `;
        document.getElementById('submitBtn').disabled = true;
        return;
      }

      window.location.href = mailtoLink;
    }

    function hideAppleBanner() {
      const placeholder = document.getElementById('apple-banner-placeholder');
      placeholder.innerHTML = '';
      const btn = document.getElementById('submitBtn');
      if (btn) btn.disabled = false;
    }

    function limpiarFormulario() {
      document.getElementById('formulari').reset();
      hideAppleBanner();
      const btn = document.getElementById('submitBtn');
      if (btn) btn.disabled = false;
    }
  </script>
</body>
</html>