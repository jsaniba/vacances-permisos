<!DOCTYPE html>
<html lang="ca">
<head>
  <meta charset="UTF-8">
  <title>Formulari de Petició</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f6f8;
      margin: 0;
      padding: 0;
    }

    .container {
      width: 640px;
      max-width: 96%;
      margin: 60px auto;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 14px rgba(0,0,0,0.15);
      padding: 28px 24px 24px 24px;
      position: relative;
    }

    /* --- Logotipo dentro del recuadro --- */
    .logo {
      position: absolute;
      top: 20px;
      left: 20px;
      width: 200px;
      height: auto;
      border-radius: 8px;
    }

    h2 {
      text-align: center;
      margin-bottom: 20px;
      color: #222;
      font-size: 22px;
      font-weight: bold;
    }

    label {
      display: block;
      margin-top: 10px;
      color: #444;
      font-weight: bold;
    }

    input[type="text"], select, textarea, input[type="date"] {
      width: 100%;
      padding: 8px;
      margin-top: 6px;
      border: 1px solid #ccc;
      border-radius: 6px;
      box-sizing: border-box;
      font-size: 14px;
    }

    .checkbox-group {
      margin-top: 8px;
    }

    hr.small {
      border: none;
      height: 1px;
      background: #ddd;
      margin: 16px 0;
    }

    button {
      width: 48%;
      padding: 12px;
      margin-top: 20px;
      border: none;
      border-radius: 8px;
      background: #007BFF;
      color: white;
      font-size: 16px;
      cursor: pointer;
    }

    button:hover { background: #0056b3; }

    button.reset {
      background: #6c757d;
    }

    button.reset:hover { background: #5a6268; }

    .apple-message {
      text-align: center;
      padding: 16px;
      border-radius: 10px;
      background: #eef6ff;
      margin-bottom: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    }

    .apple-button {
      display: inline-block;
      padding: 12px 18px;
      background: #007BFF;
      color: #fff;
      font-size: 16px;
      border-radius: 8px;
      text-decoration: none;
      margin-top: 10px;
    }

    .apple-button:hover { background: #0056b3; }

  </style>
</head>

<body>
  <div class="container" id="form-container">
    <!-- Logotipo dentro del recuadro -->
    <img src="LOGOTIPO.JPG" alt="Logotip" class="logo">

    <h2>FORMULARI DE PETICIÓ</h2>
    <div id="apple-banner-placeholder"></div>

    <form id="formulari" onsubmit="enviarFormulario(); return false;">
      <label for="nom">NOM I COGNOMS</label>
      <input type="text" id="nom" name="nom" required>

      <label for="nip">NIP</label>
      <input type="text" id="nip" name="nip" required>

      <label for="lloc">LLOC DE TREBALL</label>
      <select id="lloc" name="lloc" required>
        <option value="">-- Selecciona --</option>
        <option>Auxiliar Administratiu/iva</option>
        <option>Bibliotecari/ària</option>
        <option>Cap de Programes d'Atenció Especialitzada</option>
        <option>Cap de Programes d'Educació Social</option>
        <option>Cap de Serveis</option>
        <option>Cap d'Unitat</option>
        <option>Conductor/a</option>
        <option>Coordinador d'Equips Multidisciplinaris</option>
        <option>CUE</option>
        <option>CUSI</option>
        <option>CUSV</option>
        <option>Director/a</option>
        <option>Educador/a</option>
        <option>CAF</option>
        <option>Encarregat/a d'Àrea Administrativa</option>
        <option>Enginyer</option>
        <option>GAMP</option>
        <option>GAMV</option>
        <option>Gerent</option>
        <option>GO</option>
        <option>GSI</option>
        <option>Monitor/a formació ocupacional</option>
        <option>RIET</option>
        <option>Secretari/a Tècnic Jurídic</option>
        <option>Subdirector/a de Tractament</option>
        <option>Subdirector/a d'Interior</option>
        <option>Tècnic de Prevenció i Salut Laboral</option>
        <option>Titulat/ada Superior Criminòleg</option>
        <option>Titulat/ada Superior Pedagog/a</option>
        <option>Titulat/ada Superior Psicòleg/a</option>
        <option>TMI</option>
      </select>

      <label for="guardia">GUÀRDIA</label>
      <select id="guardia" name="guardia" required>
        <option value="">-- Selecciona --</option>
        <option>A</option>
        <option>B</option>
        <option>C</option>
        <option>D</option>
        <option>E</option>
        <option>F</option>
        <option>G</option>
        <option>H</option>
        <option>MATÍ</option>
        <option>TARDA</option>
        <option>C/S</option>
        <option>Gestió Econòmica</option>
        <option>Gestió Penitenciària</option>
        <option>OGI</option>
        <option>Recursos Humans</option>
        <option>SERVEIS EXT. C/S</option>
        <option>SERVEIS EXT. MATÍ</option>
        <option>SERVEIS EXT. TARDA</option>
        <option>SERVEIS INT. C/S</option>
        <option>SERVEIS INT. MATÍ</option>
        <option>SERVEIS INT. TARDA</option>
        <option>Suport Administratiu Equips Directius</option>
        <option>TALLERS MATÍ</option>
        <option>TALLERS TARDA</option>
        <option>USI MATÍ</option>
        <option>USI TARDA</option>
      </select>

      <hr class="small">

      <label>PLANIFICAT AMB EL QUADRANT DE LA GUÀRDIA</label>
      <div class="checkbox-group">
        <label><input type="radio" name="planificat" value="SI"> SI</label>
        <label style="margin-left:8px;"><input type="radio" name="planificat" value="NO"> NO</label>
      </div>

      <label>TIPUS DE PETICIÓ</label>
      <div class="checkbox-group">
        <label><input type="checkbox" name="tipus" value="VACANCES"> VACANCES</label><br>
        <label><input type="checkbox" name="tipus" value="ASSUMPTES PERSONALS"> ASSUMPTES PERSONALS</label><br>
        <label><input type="checkbox" name="tipus" value="COMPENSACIÓ DE FESTIUS"> COMPENSACIÓ DE FESTIUS</label><br>
        <label><input type="checkbox" name="tipus" value="HORES DE FORMACIÓ"> HORES DE FORMACIÓ</label><br>
        <label><input type="checkbox" name="tipus" value="HORES EXTRAORDINÀRIES"> HORES EXTRAORDINÀRIES</label><br>
        <label><input type="checkbox" name="tipus" value="ALTRES"> ALTRES</label>
      </div>

      <label for="especifiqueu">ESPECIFIQUEU</label>
      <input type="text" id="especifiqueu" name="especifiqueu">

      <label for="data_inici">DATA INICI</label>
      <input type="date" id="data_inici" name="data_inici" required>

      <label for="torn_inici">TORN/HORES</label>
      <input type="text" id="torn_inici" name="torn_inici">

      <label for="data_fi">DATA FI</label>
      <input type="date" id="data_fi" name="data_fi" required>

      <label for="torn_fi">TORN/HORES</label>
      <input type="text" id="torn_fi" name="torn_fi">

      <label for="total">TOTAL TORNS/HORES</label>
      <input type="text" id="total" name="total">

      <label for="observacions">OBSERVACIONS</label>
      <textarea id="observacions" name="observacions" rows="4"></textarea>

      <div style="display:flex; justify-content: space-between;">
        <button id="submitBtn" type="submit">Enviar Formulari</button>
        <button type="button" class="reset" onclick="limpiarFormulario()">Netejar Formulari</button>
      </div>
    </form>
  </div>

  <script>
    function enviarFormulario() {
      const dataInici = document.getElementById('data_inici').value;
      const dataFi = document.getElementById('data_fi').value;

      if (!dataInici || !dataFi) {
        alert("⚠️ Cal introduir totes les dates correctament abans d'enviar.");
        return;
      }

      const inici = new Date(dataInici);
      const fi = new Date(dataFi);
      if (isNaN(inici.getTime()) || isNaN(fi.getTime())) {
        alert("⚠️ Una de les dates no és vàlida.");
        return;
      }
      if (fi < inici) {
        alert("⚠️ La data final no pot ser anterior a la data inicial.");
        return;
      }

      const nom = document.getElementById('nom').value;
      const nip = document.getElementById('nip').value;
      const lloc = document.getElementById('lloc').value;
      const guardia = document.getElementById('guardia').value;
      const planificat = document.querySelector('input[name=\"planificat\"]:checked')?.value || '';
      const tipus = Array.from(document.querySelectorAll('input[name=\"tipus\"]:checked')).map(cb => cb.value).join(\", \");
      const especifiqueu = document.getElementById('especifiqueu').value;
      const tornInici = document.getElementById('torn_inici').value;
      const tornFi = document.getElementById('torn_fi').value;
      const total = document.getElementById('total').value;
      const observacions = document.getElementById('observacions').value;

      let body =
        "NOM I COGNOMS: " + nom + "\\n" +
        "NIP: " + nip + "\\n" +
        "LLOC DE TREBALL: " + lloc + "\\n" +
        "GUÀRDIA: " + guardia + "\\n\\n" +
        "----------------------------------------\\n\\n" +
        "PLANIFICAT AMB EL QUADRANT DE LA GUÀRDIA: " + planificat + "\\n" +
        "TIPUS DE PETICIÓ: " + tipus + "\\n" +
        "ESPECIFIQUEU: " + especifiqueu + "\\n" +
        "DATA INICI: " + dataInici + "\\n" +
        "TORN/HORES: " + tornInici + "\\n" +
        "DATA FI: " + dataFi + "\\n" +
        "TORN/HORES: " + tornFi + "\\n" +
        "TOTAL TORNS/HORES: " + total + "\\n" +
        "OBSERVACIONS: " + observacions;

      let subject = nip + "--" + lloc + "--" + guardia;
      const mesos = ["Gener","Febrer","Març","Abril","Maig","Juny","Juliol","Agost","Setembre","Octubre","Novembre","Desembre"];
      subject += "--" + mesos[inici.getMonth()] + " " + inici.getFullYear();

      const mailtoLink = "mailto:vacances_aps_cppb.justicia@gencat.cat?subject=" + encodeURIComponent(subject) + "&body=" + encodeURIComponent(body);
      const ua = navigator.userAgent || navigator.vendor || window.opera;

      if (/iPhone|iPad/i.test(ua)) {
        const bannerPlaceholder = document.getElementById('apple-banner-placeholder');
        bannerPlaceholder.innerHTML = `
          <div class="apple-message" id="apple-message">
            <strong>Per enviar des del teu iPhone/iPad</strong>
            <p>Prem el botó següent per obrir la teva aplicació de correu i enviar el formulari.</p>
            <a class="apple-button" href="${mailtoLink}">📧 Obrir correu</a>
            <div style="margin-top:10px;">
              <button type="button" onclick="hideAppleBanner()" style="background:#6c757d;padding:8px 12px;border-radius:6px;border:none;color:#fff;cursor:pointer;">Tancar avis</button>
            </div>
          </div>
        `;
        document.getElementById('submitBtn').disabled = true;
        return;
      }

      window.location.href = mailtoLink;
    }

    function hideAppleBanner() {
      const placeholder = document.getElementById('apple-banner-placeholder');
      placeholder.innerHTML = '';
      document.getElementById('submitBtn').disabled = false;
    }

    function limpiarFormulario() {
      document.getElementById('formulari').reset();
      hideAppleBanner();
    }
  </script>
</body>

</html>
